{"version":3,"sources":["utility.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["loadDicomAsync","file","a","Promise","resolve","reject","reader","FileReader","onload","fileContent","result","onabort","console","log","onerror","readAsArrayBuffer","fetchDicomAsync","url","indexOf","xhr","XMLHttpRequest","open","responseType","arrayBuffer","response","send","request","overrideMimeType","buffer","view","a_byte","data","responseText","ArrayBuffer","length","DataView","split","forEach","c","i","charCodeAt","setUint8","buffer2","NormalizationMode","fromEvent","require","WindowCenterWidthConst","AbdomenSoftTissues","W","L","SpineSoftTissues","SpineBone","Brain","Lungs","dropZoneStyle","borderWidth","borderColor","borderStyle","borderRadius","width","height","initialImageState","frameIndexes","currFrameIndex","multiFrameInfo","windowCenter","windowWidth","pixelMax","pixelMin","resX","resY","photometric","modality","transferSyntax","hasDICOMExtension","isValidMouseDown","NormalizationComponent","props","mode","windowItem","currNormalizeMode","onChange","Checkbox","radio","label","name","value","checked","App","myCanvasRef","myCanvasRefSagittal","myCanvasRefCorona","files","isOnlineMode","currentImage","currentSeries","currentSeriesImageObjects","clientX","clientY","seriesGlobalMax","seriesGlobalMin","maxWidth","maxHeight","handleNormalizeModeChange","e","newMode","WindowCenter","getWindowCenter","getWindowWidth","newWindowCenter","newWindowWidth","setState","useWindowCenter","useWindowWidth","state","ifShowSagittalCoronal","currentCoronaNo","currentSagittalNo","renderFrame","image","frameIndex","buildSagittalView","buildCoronalView","renderImage","daikonImage","imageData","numFrames","daikon","parseImage","isEqual","getImageDirections","isCommonAxialView","getAcquiredSliceDirection","getNumberOfFrames","Array","from","v","k","text","arg","storeMax","storeMin","canvasRef","rawData","rawDataWidth","rawDataHeight","extraHeightScale","extraWidthScale","ifRGB","rgbMode","obj","getPhotometricInterpretation","getModality","getTransferSyntax","trim","getPlanarConfig","toLowerCase","getInterpretedData","max","min","numCols","numRows","undefined","getNormalizationRange","current","document","createElement","ctx","getContext","imgData","createImageData","array","byteLength","pixelCount","j","Math","floor","putImageData","scale","resizeTotFit","c2","drawImage","error","fetchFile","currFilePath","decodeURI","checkDicomNameAndResetState","switchImage","currFileNo","buildAxialView","newFile","loadFile","switchSagittal","switchCorona","onDropFiles","acceptedFiles","sort","b","localeCompare","loadSeriesFilesToRender","totalFiles","handleSwitchFrame","onKeyDown","keyName","newFileNo","onMouseCanvasDown","event","window","addEventListener","onMouseMove","onMouseUp","removeEventListener","tmpWindowCenter","tmpWindowWidth","deltaX","deltaY","handleSeriesModeChange","seriesMode","ifWindowCenterMode","totalSagittalFrames","totalCoronaFrames","React","createRef","this","location","href","firstHash","fileURLs","substring","onOpenFileURLs","fileURLStr","push","index","clearRect","endsWith","promiseList","firstFile","fileList","all","bufferList","series","parserError","hasPixelData","images","addImage","getSeriesId","getSliceThickness","warn","buildSeries","reverse","globalMax","globalMin","w","getCols","firstSagittal","h","getRows","firstCoronal","firstImageNo","seriesObjects","i_image","j_sagittal","n_slice","i_row","spacing","getPixelSpacing","spaceH","sliceThickness","k_corona","i_column","spaceW","size","scaleW","scaleH","PixelHUMaxMin","info","allowRepeat","className","preventDropOnDocument","style","getDataTransferItems","evt","onDrop","display","flexDirection","justifyContent","alignItems","Radio","toggle","Dropdown","placeholder","selection","options","step","onMouseDown","ref","backgroundColor","Component","Boolean","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.8ce24996.chunk.js","sourcesContent":["export async function loadDicomAsync(file: any) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      const fileContent = reader.result;\n      resolve(fileContent);\n      //   this.renderImage(fileContent);\n    };\n    reader.onabort = () => console.log(\"file reading was aborted\");\n    // e.g. \"drag a folder\" will fail to read\n    reader.onerror = () => console.log(\"file reading has failed\");\n    reader.readAsArrayBuffer(file);\n  });\n}\n\nexport async function fetchDicomAsync(url: string) {\n  return new Promise((resolve, reject) => {\n    if (url.indexOf(\"file://\") === 0) {\n      const xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", url, true);\n      xhr.responseType = \"arraybuffer\";\n      xhr.onload = () => {\n        const arrayBuffer = xhr.response;\n        resolve(arrayBuffer);\n        // this.renderImage(arrayBuffer);\n      };\n      xhr.send();\n    } else {\n      // NOTE: copy from https://github.com/my-codeworks/tiff-viewer-extension/blob/master/background.js#L29\n      // TODO: figure it out why using arraybuffer will fail\n      console.log(\"Starting XHR request for\", url);\n      const request = new XMLHttpRequest();\n      request.open(\"GET\", url, false);\n      request.overrideMimeType(\"text/plain; charset=x-user-defined\");\n      request.send();\n      console.log(\"Finished XHR request\");\n      const data = request.responseText;\n      let buffer;\n      let view: DataView;\n      let a_byte;\n      buffer = new ArrayBuffer(data.length);\n      view = new DataView(buffer);\n      data.split(\"\").forEach((c, i) => {\n        a_byte = c.charCodeAt(0);\n        view.setUint8(i, a_byte & 0xff);\n      });\n      const buffer2 = view.buffer;\n      // this.renderImage(buffer2);\n      resolve(buffer2);\n    }\n  });\n\n  //   const promise = new Promise((resolve, reject) => {\n  //     this.commandDict[pipelineUrl] = { resolve, reject };\n  //   });\n}\n\nexport default {};\n","import React, { Component } from \"react\";\nimport Slider from \"rc-slider\";\nimport \"rc-slider/assets/index.css\";\nimport { isEqual } from \"underscore\";\n\nimport {\n  Dropdown,\n  Checkbox,\n  CheckboxProps,\n  DropdownProps,\n  Radio,\n} from \"semantic-ui-react\";\n\nimport Dropzone from \"react-dropzone\";\nimport Hotkeys from \"react-hot-keys\";\nimport * as daikon from \"daikon\";\nimport { fetchDicomAsync, loadDicomAsync } from \"./utility\";\n\nconst { fromEvent } = require(\"file-selector\");\n\n// import { fromEvent } from \"file-selector\";\n\nenum NormalizationMode {\n  PixelHUMaxMin,\n  // below are for CT,\n  WindowCenter,\n  // https://radiopaedia.org/articles/windowing-ct\n  AbdomenSoftTissues, //W:400 L:50\n  SpineSoftTissues, // W:250 L:50\n  SpineBone, // W:1800 L:400\n  Brain, // W:80 L:40\n  Lungs, // W:1500 L:-600. chest\n  // AbdomenLiver, // W:150 L:30.\n  // Mediastinum, // W:350 L:50.\n  // head and neck series:\n  // Stroke W:8 L:32 or W:40 L:40 中風 head\n  // subdural W:130-300 L:50-100 腦硬膜\n  // temporal bones W:2800 L:600 顳骨\n  // soft tissues: W:350–400 L:20–60. head\n  // CTA (CT angiography) // https://www.stepwards.com/?page_id=21646 (W:600, L:170)\n}\n\ninterface WindowItem {\n  W: number;\n  L: number;\n}\n\ninterface IWindowDictionary {\n  [id: number]: WindowItem;\n}\n\nconst WindowCenterWidthConst: IWindowDictionary = {\n  [NormalizationMode.AbdomenSoftTissues]: {\n    W: 400,\n    L: 50,\n  },\n  [NormalizationMode.SpineSoftTissues]: {\n    W: 250,\n    L: 50,\n  },\n  [NormalizationMode.SpineBone]: {\n    W: 1800,\n    L: 400,\n  },\n  [NormalizationMode.Brain]: {\n    W: 80,\n    L: 40,\n  },\n  [NormalizationMode.Lungs]: {\n    W: 1500,\n    L: -600,\n  },\n};\n\nconst dropZoneStyle = {\n  borderWidth: 2,\n  borderColor: \"#666\",\n  borderStyle: \"dashed\",\n  borderRadius: 5,\n  width: 800,\n  height: 150,\n  // textAlign: \"center\",\n};\n\nconst initialImageState = {\n  frameIndexes: [],\n  currFrameIndex: 0,\n  multiFrameInfo: \"\",\n  windowCenter: 0,\n  windowWidth: -1,\n  pixelMax: 0,\n  pixelMin: 0,\n  resX: 0,\n  resY: 0,\n  photometric: \"\",\n  modality: \"\",\n  transferSyntax: \"\",\n  hasDICOMExtension: true,\n  isValidMouseDown: false, // reset when switching to a new image\n};\n\ntype State = {\n  currNormalizeMode: number;\n  ifWindowCenterMode: boolean;\n  currFilePath: string;\n  currFileNo: number;\n  totalFiles: number;\n  frameIndexes: any[];\n  currFrameIndex: number;\n  multiFrameInfo: string;\n  windowCenter: number;\n  windowWidth: number;\n  pixelMax: number; // pixel max\n  pixelMin: number; // pixel min\n  resX: number;\n  resY: number;\n  photometric: string;\n  modality: string;\n  transferSyntax: string;\n  hasDICOMExtension: boolean;\n  isValidMouseDown: boolean; // switch to another image, becomes invalid\n  useWindowCenter: number;\n  useWindowWidth: number;\n  ifShowSagittalCoronal: boolean;\n  currentSagittalNo: number; // start from 1\n  totalSagittalFrames: number;\n  currentCoronaNo: number;\n  totalCoronaFrames: number;\n  seriesMode: string;\n  isCommonAxialView: boolean;\n};\n\ninterface NormalizationProps {\n  mode: NormalizationMode;\n  windowItem?: WindowItem;\n  currNormalizeMode: NormalizationMode;\n  onChange?: (\n    e: React.FormEvent<HTMLInputElement>,\n    data: CheckboxProps\n  ) => void;\n}\n\nfunction NormalizationComponent(props: NormalizationProps) {\n  const { mode, windowItem, currNormalizeMode, onChange } = props;\n  const data = windowItem ?? WindowCenterWidthConst[mode] ?? null;\n  return (\n    <>\n      <Checkbox\n        radio\n        label={NormalizationMode[mode]}\n        name=\"checkboxRadioGroup\"\n        value={mode}\n        checked={currNormalizeMode === mode}\n        onChange={onChange}\n      // checked={ifWindowCenterMode}\n      // onChange={this.handleNormalizeModeChange}\n      />\n      {data ? ` c:${data.L}, w:${data.W}  ` : `  `}\n    </>\n  );\n}\n\nconst MAX_WIDTH_SINGLE_MODE = 1280;\nconst MAX_HEIGHT_SINGLE_MODE = 1000;\nconst MAX_WIDTH_SERIES_MODE = 400;\nconst MAX_HEIGHT_SERIES_MODE = 400;\n\nclass App extends Component<{}, State> {\n  myCanvasRef: React.RefObject<HTMLCanvasElement>;\n  myCanvasRefSagittal: React.RefObject<HTMLCanvasElement>;\n  myCanvasRefCorona: React.RefObject<HTMLCanvasElement>;\n  files: any[];\n  isOnlineMode = true;\n  currentImage: any;\n  currentSeries: any;\n  currentSeriesImageObjects: any[];\n  clientX: number;\n  clientY: number;\n  seriesGlobalMax: number;\n  seriesGlobalMin: number;\n  maxWidth = MAX_WIDTH_SINGLE_MODE;\n  maxHeight = MAX_HEIGHT_SINGLE_MODE;\n\n  constructor() {\n    super({});\n    this.state = {\n      currNormalizeMode: NormalizationMode.WindowCenter,\n      ifWindowCenterMode: true,\n      currFilePath: \"\",\n      ifShowSagittalCoronal: false,\n      useWindowCenter: 0,\n      useWindowWidth: -1,\n      seriesMode: \"notSeriesMode\",\n\n      // multiFrameInfo: '',\n      // currFrameIndex: 0,\n      // frameIndexes: [],\n      // windowCenter: '',\n      // windowWidth: '',\n      // max: '',\n      // min: '',\n      // resX: '',\n      // resY: '',\n      // photometric: '',\n      // modality: '',\n      isCommonAxialView: false,\n      currFileNo: 0,\n      totalFiles: 0,\n      currentSagittalNo: 0,\n      totalSagittalFrames: 0,\n      currentCoronaNo: 0,\n      totalCoronaFrames: 0,\n      ...initialImageState,\n    };\n    this.myCanvasRef = React.createRef();\n    this.myCanvasRefSagittal = React.createRef();\n    this.myCanvasRefCorona = React.createRef();\n    this.files = [];\n    this.currentSeriesImageObjects = [];\n    this.clientX = 0;\n    this.clientY = 0;\n    this.seriesGlobalMax = 0;\n    this.seriesGlobalMin = 0;\n  }\n\n  componentDidMount() {\n    window.addEventListener(\"mouseup\", this.onMouseUp);\n    // window.addEventListener(\"mouseup\", this.onMouseUp);\n\n    // get file path from current url, e.g.\n    // chrome-extension://jfnlfimghfiagibfigmlopnfljpfnnje/dicom.html#file:///tmp/test.dcm\n    const url = window.location.href;\n    // 'http://localhost#http://medistim.com/wp-content/uploads/2016/07/ttfm.dcm'; //\n    // console.log(\"current url:\", url);\n\n    if (\n      url.toLowerCase().indexOf(\".dcm\") !== -1 ||\n      url.toLowerCase().indexOf(\".dicom\") !== -1\n    ) {\n      // const paths = url.split(\"#\");\n      const firstHash = url.indexOf(\"#\");\n      if (firstHash > -1) {\n        const fileURLs = url.substring(firstHash + 1, url.length);\n        // const filePath = paths[1];\n        // this.fetchFile(filePath);\n\n        this.onOpenFileURLs(fileURLs);\n      }\n    }\n  }\n\n  // NOTE:\n  // when switch to new image, keeps mode and useWindowWidth will not reset (if not same seris, a little wired)\n  // switch to new frame (same image)? keeps mode and useWindowWidth will not reset\n  // swtich to different mode (useWindowWidth will be reset )\n\n  handleNormalizeModeChange = (\n    e: React.FormEvent<HTMLInputElement>,\n    data: CheckboxProps\n  ) => {\n    const { value } = data;\n\n    // console.log(\"value:\", typeof value, value);\n    // let ifWindowCenterMode;\n    // if (value === \"center\") {\n    //   ifWindowCenterMode = true;\n    // } else {\n    //   ifWindowCenterMode = false;\n    // }\n\n    // this.setState({ ifWindowCenterMode });\n\n    if (this.currentImage) {\n      let windowCenter;\n      let windowWidth;\n\n      const newMode = value as number;\n      if (newMode === NormalizationMode.WindowCenter) {\n        windowCenter = this.currentImage.getWindowCenter() as number;\n        windowWidth = this.currentImage.getWindowWidth() as number;\n      }\n      const newWindowCenter = windowCenter ? windowCenter : 0;\n      const newWindowWidth = windowWidth ? windowWidth : -1;\n      this.setState({\n        useWindowCenter: newWindowCenter,\n        useWindowWidth: newWindowWidth,\n        currNormalizeMode: newMode,\n      });\n\n      const {\n        currFrameIndex,\n        ifShowSagittalCoronal,\n        currentCoronaNo,\n        currentSagittalNo,\n      } = this.state;\n      this.renderFrame({\n        image: this.currentImage,\n        frameIndex: currFrameIndex,\n        currNormalizeMode: newMode,\n        useWindowCenter: newWindowCenter,\n        useWindowWidth: newWindowWidth,\n      });\n      if (ifShowSagittalCoronal) {\n        this.buildSagittalView(\n          this.currentSeries,\n          currentSagittalNo - 1,\n          newWindowCenter,\n          newWindowWidth,\n          newMode\n        );\n        this.buildCoronalView(\n          this.currentSeries,\n          currentCoronaNo - 1,\n          newWindowCenter,\n          newWindowWidth,\n          newMode\n        );\n      }\n    }\n  };\n\n  renderImage = (\n    buffer: any,\n    daikonImage?: any,\n    imageData?: any,\n    useWindowCenter?: number,\n    useWindowWidth?: number\n  ) => {\n    // console.log(\"renderImage bytelength:\", buffer.byteLength);\n    // daikon.Parser.verbose = true;\n    let image;\n    let numFrames;\n    if (!daikonImage) {\n      try {\n        image = daikon.Series.parseImage(new DataView(buffer));\n        if (isEqual(image.getImageDirections(), [1, 0, 0, 0, 1, 0])) {\n          this.setState({ isCommonAxialView: true });\n          // console.log(\"normal dicom:\");\n        } else {\n          console.log(\"not axial dicom:\", image.getAcquiredSliceDirection());\n        }\n      } catch (e) {\n        console.log(\"parse dicom error:\", e);\n      }\n    } else {\n      image = daikonImage;\n    }\n\n    numFrames = image.getNumberOfFrames();\n\n    if (numFrames > 1) {\n      // console.log(\"frames:\", numFrames);\n      const multiFrameInfo = `It's multi-frame file (n=${numFrames})`;\n\n      this.setState({\n        multiFrameInfo,\n      });\n    }\n    this.setState({\n      frameIndexes: Array.from(\n        {\n          length: numFrames,\n        },\n        (v, k) => ({\n          text: k,\n          value: k,\n        })\n      ),\n      currFrameIndex: 0,\n    });\n    this.currentImage = image;\n\n    this.renderFrame({\n      image: this.currentImage,\n      frameIndex: 0,\n      imageData,\n      useWindowCenter,\n      useWindowWidth,\n    });\n  };\n\n  renderFrame = (\n    arg: {\n      image?: any;\n      frameIndex?: number;\n      currNormalizeMode?: number;\n      useWindowWidth?: number;\n      useWindowCenter?: number;\n      canvasRef?: React.RefObject<HTMLCanvasElement>;\n      rawData?: number[];\n      rawDataWidth?: number;\n      rawDataHeight?: number;\n      extraHeightScale?: number;\n      extraWidthScale?: number;\n\n      imageData?: {\n        // only for axial view\n        max?: number;\n        min?: number;\n        numCols?: number;\n        numRows?: number;\n        data?: number[];\n      };\n    }\n    // ifWindowCenterMode?: boolean\n  ) => {\n    let {\n      image,\n      frameIndex,\n      currNormalizeMode,\n      useWindowWidth,\n      useWindowCenter,\n      canvasRef,\n      rawData,\n      rawDataWidth,\n      rawDataHeight,\n      extraHeightScale,\n      extraWidthScale,\n      imageData,\n    } = arg;\n    // console.log(`switch to ${frameIndex} Frame`);\n\n    let ifRGB = false;\n    let rgbMode = 0; // 0: rgbrgb... 1: rrrgggbbb\n    let windowWidth: number | null = null;\n    let windowCenter: number | null = null;\n    let storeMax;\n    let storeMin;\n\n    if (!canvasRef || canvasRef === this.myCanvasRef) {\n      // BUG:\n      // fetchFile (file://) case will need longer time to getPhotometricInterpretation after using a while\n      const photometric = image.getPhotometricInterpretation();\n      const modality = image.getModality();\n      const transferSyntax = image.getTransferSyntax();\n      if (photometric !== null) {\n        // const mode = image.getPlanarConfig();\n        if (photometric.trim().indexOf(\"RGB\") !== -1) {\n          ifRGB = true;\n\n          rgbMode = image.getPlanarConfig() || 0;\n          console.log(\"Planar mode:\", rgbMode);\n        } else if (photometric.trim().toLowerCase().indexOf(\"palette\") !== -1) {\n          ifRGB = true;\n        }\n      }\n\n      // getPhotometricInterpretation\n      // https://github.com/rii-mango/Daikon/issues/4\n      // The new function will handle things like byte order, number of bytes per voxel, datatype, data scales, etc.\n      // It returns an array of floating point values. So far this is only working for plain intensity data, not RGB.\n      let obj;\n      if (!imageData) {\n        try {\n          // BUG: latest daikon will throw a exception when calliing getInterpretedData for palette case\n          obj = image.getInterpretedData(false, true, frameIndex); // obj.data: float32array\n        } catch (e) {\n          console.log(\"read dicom InterpretedData error:\", e);\n          return;\n        }\n      } else {\n        obj = imageData;\n      }\n\n      storeMax = obj.max;\n      storeMin = obj.min;\n      rawData = obj.data as number[];\n      rawDataWidth = obj.numCols as number;\n      rawDataHeight = obj.numRows as number;\n      // center/width may be null\n      windowCenter = image.getWindowCenter() as number;\n      windowWidth = image.getWindowWidth() as number;\n      // console.log(\"max:\", typeof obj.max);\n      // console.log(\"windowCenter:\", typeof windowCenter);\n      this.setState({\n        windowCenter,\n        windowWidth,\n        pixelMax: obj.max,\n        pixelMin: obj.min,\n        resX: rawDataWidth,\n        resY: rawDataHeight,\n        modality,\n        transferSyntax,\n        photometric,\n      });\n    }\n\n    if (!rawDataWidth || !rawDataHeight) {\n      console.error(\"no width/height info. give up render \");\n      return;\n    }\n    if (!rawData) {\n      console.error(\"no rawData. give up render \");\n      return;\n    }\n\n    let max;\n    let min;\n    if (currNormalizeMode === undefined) {\n      ({ currNormalizeMode } = this.state);\n    }\n    if (useWindowWidth === undefined) {\n      ({ useWindowWidth } = this.state);\n    }\n    if (useWindowCenter === undefined) {\n      ({ useWindowCenter } = this.state);\n    }\n    // console.log(\"useWindowWidth:\", useWindowWidth);\n    ({ max, min } = this.getNormalizationRange(\n      useWindowWidth,\n      useWindowCenter,\n      currNormalizeMode,\n      windowWidth,\n      windowCenter,\n      storeMax ? storeMax : this.seriesGlobalMax,\n      storeMin ? storeMin : this.seriesGlobalMin\n    ));\n\n    if (!canvasRef) {\n      canvasRef = this.myCanvasRef;\n    }\n    if (!canvasRef.current) {\n      console.log(\"canvasRef is not ready, return\");\n      return;\n    }\n\n    // const c = this.myCanvasRef.current; // document.getElementById(\"myCanvas\");\n    const c = document.createElement(\"canvas\");\n    c.width = rawDataWidth;\n    c.height = rawDataHeight;\n    // Create context from canvas\n    const ctx = c.getContext(\"2d\");\n    // Create ImageData object\n    if (!ctx) {\n      return;\n    }\n    const imgData = ctx.createImageData(rawDataWidth, rawDataHeight);\n    const { data } = imgData; // .data; // width x height x 4 (RGBA), Uint8ClampedArray\n\n    if (!ifRGB) {\n      for (let i = 0, k = 0; i < data.byteLength; i += 4, k += 1) {\n        let value = rawData[k];\n\n        // Create array view\n        // const array = new Uint8ClampedArray(rawData.length);\n        // BUG: coranal/sagittal may have undefined so will not have normalization\n        if (max && min) {\n          const delta = max - min;\n          // for (let i = 0; i < rawData.length; i += 1) {\n          // truncate\n          if (min !== storeMin || max !== storeMax) {\n            if (value > max) {\n              value = max;\n            } else if (value < min) {\n              value = min;\n            }\n          }\n          // normalization\n          value = ((value - min) * 255) / delta;\n          // }\n        }\n\n        data[i] = value;\n        data[i + 1] = value;\n        data[i + 2] = value;\n        data[i + 3] = 255;\n      }\n    } else if (rgbMode === 0) {\n      // if 3 channels, pixel array'order is at Tag (0028, 0006)\n      // Planar Configuration = 0 -> R1, G1, B1, R2, G2, B2, …\n      // Planar Configuration = 1 -> R1, R2, R3, …, G1, G2, G3, …, B1, B2, B3\n      const array = rawData;\n      for (let i = 0, k = 0; i < data.byteLength; i += 1, k += 1) {\n        data[i] = array[k];\n        if ((i + 2) % 4 === 0) {\n          data[i + 1] = 255;\n          i += 1;\n        }\n      }\n    } else {\n      // Note: tested. https://barre.dev/medical/samples/US-RGB-8-epicard\n      const array = rawData;\n      const pixelCount = array.length / 3;\n      for (let i = 0, k = 0; i < data.byteLength; i += 1, k += 1) {\n        // data[i] = array[k];\n\n        const j = Math.floor(i / 4); // jth pixel, start from 0\n        if ((i + 1) % 4 === 1) {\n          // r\n          data[i] = array[j];\n        } else if ((i + 1) % 4 === 2) {\n          // g\n          data[i] = array[j + pixelCount];\n        } else if ((i + 1) % 4 === 3) {\n          // b\n          data[i] = array[j + pixelCount * 2];\n\n          data[i + 1] = 255;\n          i += 1;\n        }\n      }\n    }\n\n    // console.log(\"fill data to ctx's imagedata done, then draw our imagedata onto the canvas\")\n    ctx.putImageData(imgData, 0, 0);\n\n    let scale = 1;\n    if (!extraHeightScale || !extraWidthScale) {\n      scale = this.resizeTotFit(rawDataWidth, rawDataHeight);\n    }\n    //  else if (canvasRef === this.myCanvasRefSagittal) {\n    //   // sagittal view\n    //   scale = this.resizeTotFit(1, rawDataWidth);\n    // } else {\n    //   scale = this.resizeTotFit(rawDataWidth, rawDataHeight);\n    // }\n\n    if (scale !== 1) {\n      // console.log(\"scale:\", scale);\n    }\n    const c2: any = canvasRef.current;\n    c2.width = rawDataWidth / scale;\n    c2.height = rawDataHeight / scale;\n    if (extraHeightScale) {\n      c2.height = c2.height * extraHeightScale;\n    }\n    if (extraWidthScale) {\n      c2.width = c2.width * extraWidthScale;\n    }\n    const ctx2 = c2.getContext(\"2d\");\n    ctx2.drawImage(c, 0, 0, c2.width, c2.height);\n  };\n\n  async onOpenFileURLs(fileURLStr: string) {\n    const files = fileURLStr.split(\"file://\"); // https:// or file://xx + file://xx2\n    files.sort((a, b) => {\n      return a.localeCompare(b);\n    });\n    console.log(\"sorted files:\", files);\n\n    // case1:\n    // e.g. chrome-extension://fpklmaeeoagikoaiakadencfmhodampd/index.html#https://raw.githubusercontent.com/grimmer0125/dicom-web-viewer/test/image-00000-ot.dcm\n    // -> fileURLStr = \"https://raw.githubusercontent.com/grimmer0125/dicom-web-viewer/test/image-00000-ot.dcm\"\n    // -> files = [\"https://raw.githubusercontent.com/grimmer0125/dicom-web-viewer/test/image-00000-ot.dcm]\n\n    // case2:\n    // drag a local file. e.g. fileURLs.split(\"file://\"); fileURLStr = \"file://xxx.dcm\"\n    // files = [\"\", \"/users/grimmer/downloads/dicom/image-00000-ot.dcm\"]\n\n    this.files = [];\n    if (files.length === 1) {\n      // case1\n      this.files.push(`${files[0]}`);\n    } else {\n      // case2\n      files.forEach((file, index) => {\n        if (index !== 0 || files.length === 1) {\n          this.files.push(`file://${file}`);\n        }\n      });\n    }\n\n    const { ifShowSagittalCoronal } = this.state;\n    if (ifShowSagittalCoronal) {\n      await this.loadSeriesFilesToRender(this.files);\n    } else {\n      this.setState({\n        totalFiles: this.files.length,\n        currFileNo: 1,\n      });\n      this.fetchFile(this.files[0]);\n    }\n  }\n\n  fetchFile = async (url: string) => {\n    this.setState({\n      currFilePath: decodeURI(url),\n    });\n\n    if (!this.checkDicomNameAndResetState(url)) {\n      return;\n    }\n\n    const buffer = await fetchDicomAsync(url);\n    this.renderImage(buffer);\n  };\n\n  switchImage = (value: number) => {\n    this.setState({\n      currFileNo: value,\n    });\n\n    const { ifShowSagittalCoronal } = this.state;\n    // console.log(\"ifShowSagittalCoronal:\", ifShowSagittalCoronal);\n    if (ifShowSagittalCoronal) {\n      this.buildAxialView(\n        this.currentSeries,\n        this.currentSeriesImageObjects,\n        value - 1\n      );\n    } else {\n      const newFile = this.files[value - 1];\n      // console.log(\"switch to image:\", value, newFile);\n      if (!this.isOnlineMode) {\n        this.loadFile(newFile);\n      } else {\n        this.fetchFile(newFile);\n      }\n    }\n  };\n\n  switchSagittal = (value: number) => {\n    this.setState({\n      currentSagittalNo: value,\n    });\n\n    this.buildSagittalView(this.currentSeries, value - 1);\n  };\n\n  switchCorona = (value: number) => {\n    this.setState({\n      currentCoronaNo: value,\n    });\n\n    this.buildCoronalView(this.currentSeries, value - 1);\n  };\n\n  checkDicomNameAndResetState(name: string) {\n    const c2: any = this.myCanvasRef.current;\n    if (c2) {\n      // console.log(\"reset canvas\");\n      const ctx2 = c2.getContext(\"2d\");\n      ctx2.clearRect(0, 0, c2.width, c2.height);\n    }\n    this.setState({\n      ...initialImageState,\n      isCommonAxialView: false,\n    });\n    const { ifShowSagittalCoronal } = this.state;\n    if (!ifShowSagittalCoronal) {\n      this.setState({\n        useWindowCenter: 0,\n        useWindowWidth: -1,\n      });\n    }\n    // \"file:///Users/grimmer/NCKUH_lung/.DS_Store\"\n    if (\n      name.toLowerCase().endsWith(\".dcm\") === false &&\n      name.toLowerCase().endsWith(\".dicom\") === false\n    ) {\n      console.log(\"not dicom file:\", name);\n\n      this.setState({\n        hasDICOMExtension: false,\n      });\n\n      return false;\n    }\n\n    return true;\n  }\n\n  /* eslint-disable */\n  async loadFile(file: any) {\n    this.setState({\n      currFilePath: file.name,\n    });\n\n    if (!this.checkDicomNameAndResetState(file.name)) {\n      return;\n    }\n\n    const buffer = await loadDicomAsync(file);\n    this.renderImage(buffer);\n  }\n\n  async loadSeriesFilesToRender(files: string[] | any[]) {\n    const promiseList: any[] = [];\n    let firstFile = \"\";\n    const fileList: any[] = [];\n    this.files.forEach((file, index) => {\n      // TODO: filter  invalid dicom, e.g. .DS file\n\n      if (typeof file === \"string\") {\n        if (\n          file.toLowerCase().endsWith(\".dcm\") === false &&\n          file.toLowerCase().endsWith(\".dicom\") === false\n        ) {\n          return;\n        }\n        fileList.push(file);\n        if (!firstFile) {\n          firstFile = decodeURI(file);\n          // ~ loadFile/fetchFile\n          this.setState({\n            currFilePath: firstFile,\n          });\n          if (!this.checkDicomNameAndResetState(file)) {\n          }\n        }\n        promiseList.push(fetchDicomAsync(file));\n      } else {\n        if (\n          file.name.toLowerCase().endsWith(\".dcm\") === false &&\n          file.name.toLowerCase().endsWith(\".dicom\") === false\n        ) {\n          return;\n        }\n        fileList.push(file);\n        if (!firstFile) {\n          firstFile = file.name;\n          this.setState({\n            currFilePath: file.name,\n          });\n          if (!this.checkDicomNameAndResetState(file.name)) {\n          }\n        }\n        promiseList.push(loadDicomAsync(file));\n      }\n    });\n    this.files = fileList;\n\n    const bufferList = await Promise.all(promiseList);\n    // console.log(\"bufferList:\", bufferList);\n    const series = new daikon.Series();\n\n    for (const buffer of bufferList) {\n      const image = daikon.Series.parseImage(new DataView(buffer as any));\n      // console.log(image.getSliceLocation());\n\n      // const orientationArray = image.getImageDirections(); //[1,0,0,0,1,0] Tag\t(0020,0037)\n      // const daikonOrientation = image.getOrientation(); //XYZ--+\n      // console.log(\n      //   \"orientationArray:\",\n      //   orientationArray,\n      //   \";daikonOrientation:\",\n      //   daikonOrientation\n      // );\n\n      if (image === null) {\n        console.error(daikon.Series.parserError);\n      } else if (image.hasPixelData()) {\n        // Anatomical Orientation Type Attribute\n        // https://dicom.innolitics.com/ciods/12-lead-ecg/general-series/00102210\n        // Patient Orientation:\n        // https://dicom.innolitics.com/ciods/cr-image/general-image/00200020\n\n        // axial DICOM looks like a mirror image !! if its 0020,0037 is 1,0,0,0,1.0\n        // https://stackoverflow.com/questions/34782409/understanding-dicom-image-attributes-to-get-axial-coronal-sagittal-cuts/34783893\n        // https://dicom.innolitics.com/ciods/ct-image/image-plane/00200037\n\n        // https://www.slicer.org/wiki/Coordinate_systems\n\n        if (series.images.length === 0) {\n          series.addImage(image);\n          if (isEqual(image.getImageDirections(), [1, 0, 0, 0, 1, 0])) {\n            this.setState({ isCommonAxialView: true });\n            // console.log(\"normal dicom:\");\n          } else {\n            console.log(\"not axial dicom:\", image.getAcquiredSliceDirection());\n          }\n        }\n\n        // if it's part of the same series, add it\n        else if (image.getSeriesId() === series.images[0].getSeriesId()) {\n          if (\n            image.getSliceThickness() === series.images[0].getSliceThickness()\n          ) {\n            series.addImage(image);\n          } else {\n            console.warn(\"not same slicethickness\");\n          }\n        } else {\n          console.warn(\"not same seriesID(defined by daikon)\");\n        }\n      }\n    }\n    // order the image files, determines number of frames, etc.\n\n    if (series.images.length > 0) {\n      series.buildSeries();\n      series.images.reverse(); //since buildSeries will sort by z increase\n      this.currentSeries = series;\n      this.currentSeriesImageObjects = [];\n      let useWindowCenter = series.images[0].getWindowCenter() as number;\n      let useWindowWidth = series.images[0].getWindowWidth() as number;\n      let globalMax = 0;\n      let globalMin = 0;\n      series.images.forEach((image: any) => {\n        // TODO: handle exception case\n        const obj = image.getInterpretedData(false, true, 0); // obj.data: float32array\n        let max = obj.max;\n        let min = obj.min;\n        this.currentSeriesImageObjects.push(obj);\n        // if (useWindowCenter === null) {\n        if (globalMax === undefined || max > globalMax) {\n          globalMax = max;\n        }\n        if (globalMin === undefined || min < globalMin) {\n          globalMin = min;\n        }\n        // }\n      });\n      this.seriesGlobalMax = globalMax;\n      this.seriesGlobalMin = globalMin;\n      if (useWindowWidth) {\n        this.setState({\n          useWindowCenter,\n          useWindowWidth,\n        });\n      } else {\n        this.setState({\n          useWindowCenter: Math.floor((globalMax + globalMin) / 2),\n          useWindowWidth: globalMax - globalMin,\n        });\n      }\n\n      const w = series.images[0].getCols();\n      const firstSagittal = Math.floor(w / 2);\n      this.setState({\n        totalSagittalFrames: w, //this.files.length,\n        currentSagittalNo: firstSagittal + 1,\n      });\n      // build SAGITTAL\n      this.buildSagittalView(\n        series,\n        firstSagittal,\n        useWindowCenter,\n        useWindowWidth\n      );\n      // build CORONAL views\n      const h = series.images[0].getRows();\n      const firstCoronal = Math.floor(h / 2);\n      this.setState({\n        totalCoronaFrames: h, //this.files.length,\n        currentCoronaNo: firstCoronal + 1,\n      });\n      this.buildCoronalView(\n        series,\n        firstCoronal,\n        useWindowCenter,\n        useWindowWidth\n      );\n\n      const firstImageNo = Math.floor(series.images.length / 2);\n      this.setState({\n        totalFiles: this.files.length,\n        currFileNo: firstImageNo + 1,\n      });\n      this.buildAxialView(\n        series,\n        this.currentSeriesImageObjects,\n        firstImageNo,\n        useWindowCenter,\n        useWindowWidth\n      );\n      // NOTE: not support multi-frame or not default axial view now\n      // for (const image of images) {\n      //   console.log(image.getSliceLocation());\n      // }\n    } else {\n      console.warn(\"no series image\");\n    }\n  }\n\n  buildAxialView(\n    series: any,\n    seriesObjects: any[],\n    i_image: number,\n    useWindowCenter?: number,\n    useWindowWidth?: number\n  ) {\n    const daikonImage = series.images[i_image];\n    const imageData = seriesObjects[i_image];\n    this.renderImage(\n      null,\n      daikonImage,\n      imageData,\n      useWindowCenter,\n      useWindowWidth\n    );\n  }\n\n  onDropFiles = async (acceptedFiles: any[]) => {\n    if (acceptedFiles.length > 0) {\n      acceptedFiles.sort((a, b) => {\n        return a.name.localeCompare(b.name);\n      });\n      this.isOnlineMode = false;\n      this.files = acceptedFiles;\n      // this.setState({\n      //   totalFiles: this.files.length,\n      //   currFileNo: 1,\n      // });\n      const { ifShowSagittalCoronal } = this.state;\n\n      if (ifShowSagittalCoronal) {\n        await this.loadSeriesFilesToRender(this.files);\n      } else {\n        // console.log(\"ifShowSagittalCoronal = false\");\n        this.setState({\n          totalFiles: this.files.length,\n          currFileNo: 1,\n        });\n        this.loadFile(this.files[0]);\n      }\n    }\n  };\n\n  // toward left hand\n  buildSagittalView(\n    series: any,\n    j_sagittal: number,\n    useWindowCenter?: number,\n    useWindowWidth?: number,\n    currNormalizeMode?: number\n  ) {\n    const images = series.images;\n    // console.log(\"series images:\", images);\n    const w = images[0].getCols();\n    const h = images[0].getRows();\n    if (j_sagittal >= w) {\n      console.error(\"j_sagittal is >=w, invalid\");\n      return;\n    }\n    const n_slice = images.length;\n    // sggittal: h*n_slice, total: w. j-ith sgg view in w frames\n    // 0th row: series.images[0] - j-th column\n    const rawData: number[] = []; //new Array<number>(h * n_slice);\n    // iterate each slice\n    this.currentSeriesImageObjects.forEach((obj: any) => {\n      const data = obj.data as number[];\n      // j column, toward right hand\n      for (let i_row = 0; i_row < h; i_row++) {\n        rawData.push(data[j_sagittal + w * i_row]);\n      }\n    });\n    if (rawData.length !== h * n_slice) {\n      console.error(\"sagittal view's number of element is wrong\");\n      return;\n    }\n\n    const spacing = images[0].getPixelSpacing();\n    const spaceW = spacing[0];\n    const spaceH = spacing[1]; // shoudl equal to spaceW\n    const sliceThickness = images[0].getSliceThickness();\n\n    let scale = 1;\n    scale = this.resizeTotFit(w, h);\n\n    this.renderFrame({\n      canvasRef: this.myCanvasRefSagittal,\n      rawData,\n      rawDataWidth: h,\n      rawDataHeight: n_slice,\n      extraHeightScale: sliceThickness / spaceH / scale,\n      extraWidthScale: 1 / scale,\n      useWindowCenter,\n      useWindowWidth,\n      currNormalizeMode,\n    });\n  }\n\n  // toward posterior side of the patient.\n  buildCoronalView(\n    series: any,\n    k_corona: number,\n    useWindowCenter?: number,\n    useWindowWidth?: number,\n    currNormalizeMode?: number\n  ) {\n    const images = series.images;\n    // console.log(\"series images:\", images);\n    const w = images[0].getCols();\n    const h = images[0].getRows();\n    if (k_corona >= h) {\n      console.error(\"k_corona is >=h, invalid\");\n      return;\n    }\n    const n_slice = images.length;\n    // sggittal: w*n_slice, tota: h. k-th corona view in h frames\n    // 0th row: series.images[0] - 0th or final row\n    const rawData: number[] = []; //new Array<number>(h * n_slice);\n    // iterate each slice\n    this.currentSeriesImageObjects.forEach((obj: any) => {\n      // const obj = image.getInterpretedData(false, true, 0); // obj.data: float32array\n      const data = obj.data as number[];\n      // j column, toward right hand\n      for (let i_column = 0; i_column < w; i_column++) {\n        rawData.push(data[i_column + w * k_corona]);\n      }\n    });\n    if (rawData.length !== h * n_slice) {\n      console.error(\"coronal view's number of element is wrong\");\n      return;\n    }\n\n    const spacing = images[0].getPixelSpacing();\n    const spaceW = spacing[0];\n    const spaceH = spacing[1]; // shoudl equal to spaceW\n    const sliceThickness = images[0].getSliceThickness();\n\n    let scale = 1;\n    scale = this.resizeTotFit(w, h);\n\n    this.renderFrame({\n      canvasRef: this.myCanvasRefCorona,\n      rawData,\n      rawDataWidth: w,\n      rawDataHeight: n_slice,\n      extraHeightScale: sliceThickness / spaceW / scale,\n      extraWidthScale: 1 / scale,\n      useWindowCenter,\n      useWindowWidth,\n      currNormalizeMode,\n    });\n  }\n\n  handleSwitchFrame = (\n    e: React.SyntheticEvent<HTMLElement, Event>,\n    obj: DropdownProps\n  ) => {\n    const value = obj.value as number;\n\n    console.log(\"switch frame:\", value);\n\n    this.setState({\n      currFrameIndex: value,\n    });\n    this.renderFrame({ image: this.currentImage, frameIndex: value });\n  };\n\n  resizeTotFit(width: number, height: number) {\n    let scale = 1;\n    const size = {\n      maxWidth: this.maxWidth,\n      maxHeight: this.maxHeight,\n    };\n    if (width <= size.maxWidth && height <= size.maxHeight) {\n      return scale;\n    }\n    const scaleW = width / size.maxWidth;\n    const scaleH = height / size.maxHeight;\n    scale = scaleW >= scaleH ? scaleW : scaleH;\n\n    return scale;\n  }\n\n  onKeyDown = (keyName: string) => {\n    const { totalFiles, currFileNo } = this.state;\n    let newFileNo = currFileNo;\n    if (totalFiles > 1) {\n      if (keyName === \"right\") {\n        newFileNo += 1;\n        if (newFileNo > totalFiles) {\n          return;\n        }\n      } else if (keyName === \"left\") {\n        newFileNo -= 1;\n        if (newFileNo < 1) {\n          return;\n        }\n      }\n    } else {\n      return;\n    }\n\n    this.switchImage(newFileNo);\n  };\n\n  onMouseCanvasDown = (event: any) => {\n    console.log(\"onMouseDown:\", event);\n    this.setState({\n      isValidMouseDown: true,\n    });\n\n    this.clientX = event.clientX;\n    this.clientY = event.clientY;\n\n    // register mouse move event\n    window.addEventListener(\"mousemove\", this.onMouseMove);\n  };\n\n  onMouseUp = (event: any) => {\n    // console.log(\"onMouseUp:\", event);\n    this.setState({\n      isValidMouseDown: false,\n    });\n\n    // unregister mouse move event\n    window.removeEventListener(\"mousemove\", this.onMouseMove);\n  };\n\n  // TODO: add throttle-debounce\n  onMouseMove = (event: any) => {\n    // console.log(\"onMousemove:\", event);\n    // const { clientX, scrollLeft, scrollTop, clientY } = this.state;\n    // this._scroller.scrollLeft = scrollLeft - clientX + event.clientX;\n    // this._scroller.scrollTop = scrollTop - clientY + event.clientY;\n    const {\n      isValidMouseDown,\n      windowCenter,\n      windowWidth,\n      pixelMax,\n      pixelMin,\n      useWindowWidth,\n      useWindowCenter,\n      currFrameIndex,\n      currNormalizeMode,\n      ifShowSagittalCoronal,\n      currentCoronaNo,\n      currentSagittalNo,\n    } = this.state;\n    if (isValidMouseDown) {\n      const {\n        max,\n        min,\n        tmpWindowCenter,\n        tmpWindowWidth,\n      } = this.getNormalizationRange(\n        useWindowWidth,\n        useWindowCenter,\n        currNormalizeMode,\n        windowWidth,\n        windowCenter,\n        pixelMax,\n        pixelMin\n      );\n\n      if (tmpWindowCenter !== undefined && tmpWindowWidth !== undefined) {\n        let deltaX = event.clientX - this.clientX;\n        const deltaY = this.clientY - event.clientY;\n        // console.log(\"deltaY:\", deltaY);\n\n        let newWindowWidth = tmpWindowWidth + deltaX;\n        if (newWindowWidth <= 1) {\n          // console.log(\"newWindowWidth minus:\", newWindowWidth);\n          newWindowWidth = 2;\n          deltaX = newWindowWidth - tmpWindowWidth;\n        }\n        if (deltaX === 0 && deltaY === 0) {\n          return;\n        }\n        // console.log(\"newWindowWidth:\", newWindowWidth);\n        const newWindowCenter = tmpWindowCenter + deltaY;\n        this.setState({\n          useWindowCenter: newWindowCenter,\n          useWindowWidth: newWindowWidth,\n        });\n        this.renderFrame({\n          image: this.currentImage,\n          frameIndex: currFrameIndex,\n          currNormalizeMode: currNormalizeMode,\n          useWindowCenter: newWindowCenter,\n          useWindowWidth: newWindowWidth,\n        });\n        if (ifShowSagittalCoronal) {\n          this.buildSagittalView(\n            this.currentSeries,\n            currentSagittalNo - 1,\n            newWindowCenter,\n            newWindowWidth\n          );\n          this.buildCoronalView(\n            this.currentSeries,\n            currentCoronaNo - 1,\n            newWindowCenter,\n            newWindowWidth\n          );\n        }\n      }\n\n      // max/min mode\n      // default window center mode\n    }\n    this.clientX = event.clientX;\n    this.clientY = event.clientY;\n  };\n\n  getNormalizationRange(\n    useWindowWidth: number,\n    useWindowCenter: number,\n    currNormalizeMode: number,\n    windowWidth: number | null,\n    windowCenter: number | null,\n    pixelMax: number,\n    pixelMin: number\n  ) {\n    let max;\n    let min;\n    let tmpWindowCenter;\n    let tmpWindowWidth;\n    // console.log(\n    //   \"a:\",\n    //   useWindowWidth, // -1\n    //   useWindowCenter, // 0\n    //   windowWidth, // null\n    //   windowCenter // null\n    // );\n    if (useWindowWidth >= 0 && useWindowCenter !== undefined) {\n      tmpWindowCenter = useWindowCenter;\n      tmpWindowWidth = useWindowWidth;\n    } else if (currNormalizeMode === NormalizationMode.WindowCenter) {\n      if (windowWidth !== null && windowWidth >= 0 && windowCenter !== null) {\n        tmpWindowCenter = windowCenter;\n        tmpWindowWidth = windowWidth;\n      }\n    } else if (currNormalizeMode === NormalizationMode.PixelHUMaxMin) {\n    } else {\n      const data = WindowCenterWidthConst[currNormalizeMode];\n      tmpWindowCenter = data.L;\n      tmpWindowWidth = data.W;\n    }\n    if (tmpWindowWidth !== undefined && tmpWindowCenter !== undefined) {\n      min = tmpWindowCenter - Math.floor(tmpWindowWidth / 2);\n      max = tmpWindowCenter + Math.floor(tmpWindowWidth / 2);\n    } else {\n      // max/min\n      max = pixelMax;\n      min = pixelMin;\n      // ({ max, min } = obj);\n    }\n\n    // console.log(\"t:\", max, min, pixelMax, pixelMin);\n\n    return {\n      max,\n      min,\n      tmpWindowCenter,\n      tmpWindowWidth,\n    };\n  }\n\n  handleSeriesModeChange = async (e: any, obj: any) => {\n    // e: React.SyntheticEvent<HTMLElement, Event>,\n    // obj: DropdownProps\n    const { value } = obj;\n    // console.log(\"mode:\", value);\n    const { seriesMode } = this.state;\n    if (seriesMode === \"seriesMode\") {\n      this.setState({\n        seriesMode: \"notSeriesMode\",\n        ifShowSagittalCoronal: false,\n      });\n      this.maxWidth = MAX_WIDTH_SINGLE_MODE;\n      this.maxHeight = MAX_HEIGHT_SINGLE_MODE;\n      if (this.files.length > 0) {\n        console.log(\"ifShowSagittalCoronal = false\");\n        this.setState({\n          totalFiles: this.files.length,\n          currFileNo: 1,\n        });\n        if (this.isOnlineMode) {\n          this.fetchFile(this.files[0]);\n        } else {\n          this.loadFile(this.files[0]);\n        }\n      }\n    } else if (seriesMode === \"notSeriesMode\") {\n      this.maxWidth = MAX_WIDTH_SERIES_MODE;\n      this.maxHeight = MAX_HEIGHT_SERIES_MODE;\n      this.setState({ seriesMode: \"seriesMode\", ifShowSagittalCoronal: true });\n      if (this.files.length > 0) {\n        await this.loadSeriesFilesToRender(this.files);\n      }\n    }\n  };\n\n  render() {\n    const {\n      currFilePath,\n      multiFrameInfo,\n      frameIndexes,\n      currFrameIndex,\n      ifWindowCenterMode,\n      currNormalizeMode,\n      windowCenter,\n      windowWidth,\n      pixelMax,\n      pixelMin,\n      resX,\n      resY,\n      photometric,\n      modality,\n      transferSyntax,\n      currFileNo,\n      totalFiles,\n      hasDICOMExtension,\n      useWindowWidth,\n      useWindowCenter,\n      ifShowSagittalCoronal,\n      currentSagittalNo,\n      totalSagittalFrames,\n      currentCoronaNo,\n      totalCoronaFrames,\n      seriesMode,\n      isCommonAxialView,\n    } = this.state;\n    let info = \"\";\n    info += ` modality:${modality};photometric:${photometric};transferSyntax:${transferSyntax}`;\n    if (resX && resY) {\n      info += ` resolution:${resX}x${resY}`;\n    }\n    if (multiFrameInfo) {\n      info += `; ${multiFrameInfo}`;\n    }\n\n    const {\n      max,\n      min,\n      tmpWindowCenter,\n      tmpWindowWidth,\n    } = this.getNormalizationRange(\n      useWindowWidth,\n      useWindowCenter,\n      currNormalizeMode,\n      windowWidth,\n      windowCenter,\n      pixelMax,\n      pixelMin\n    );\n\n    return (\n      <Hotkeys\n        allowRepeat\n        keyName=\"right,left\"\n        onKeyDown={this.onKeyDown}\n      // onKeyUp={this.onKeyUp.bind(this)}\n      >\n        <div className=\"flex-container\">\n          <div>\n            <div className=\"flex-container\">\n              <div>\n                DICOM Image Viewer (feat: 1. click DICOM url 2. click extension\n                icon (or ctrl+u/cmd+u) to open <br></br>viewer page 3. drag any\n                DICOM file into Chrome without opening viewer first 4.\n                <a href=\"https://github.com/grimmer0125/dicom-web-viewer/wiki\">\n                  {\" \"}\n                  More (e.g. CLI and Instruction)!\n                </a>\n              </div>\n            </div>\n            <div>\n              <div className=\"flex-container\">\n                <Dropzone\n                  preventDropOnDocument={false}\n                  style={dropZoneStyle}\n                  getDataTransferItems={(evt) => fromEvent(evt)}\n                  onDrop={this.onDropFiles}\n                >\n                  <div\n                    style={{\n                      height: \"100%\",\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                    }}\n                  >\n                    <div>\n                      <p>\n                        {\" \"}\n                        Try dropping DICOM image files/folder here, <br />\n                        or click here to select files to view. <br />\n                        You need to enable file url access in extenstion DETAILS\n                        setting page. <br /> Use right/left key to switch &\n                        mouse press+move to change window center (level) <br />\n                        and widow width\n                      </p>\n                    </div>\n                  </div>\n                </Dropzone>\n              </div>\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                }}\n              >\n                {info}\n              </div>\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                }}\n              >\n                <div>\n                  <div className=\"flex-container\">\n                    {`pixel/HU max:${pixelMax}, min:${pixelMin}; useWindowCenter:${tmpWindowCenter ?? \"\"\n                      }, useWindowWidth:${tmpWindowWidth ?? \"\"\n                      }; Normalization mode:`}\n                    <br></br>\n                    {`(WindowCenter mode will fallback to Pixel/HU MaxMin if no value):`}\n                  </div>\n                  <div>\n                    <NormalizationComponent\n                      mode={NormalizationMode.WindowCenter}\n                      windowItem={\n                        windowWidth >= 0\n                          ? { L: windowCenter, W: windowWidth }\n                          : undefined\n                      }\n                      currNormalizeMode={currNormalizeMode}\n                      onChange={this.handleNormalizeModeChange}\n                    />\n                    <NormalizationComponent\n                      mode={NormalizationMode.PixelHUMaxMin}\n                      currNormalizeMode={currNormalizeMode}\n                      onChange={this.handleNormalizeModeChange}\n                    />\n                  </div>\n                  <div>\n                    <NormalizationComponent\n                      mode={NormalizationMode.AbdomenSoftTissues}\n                      currNormalizeMode={currNormalizeMode}\n                      onChange={this.handleNormalizeModeChange}\n                    />\n\n                    <NormalizationComponent\n                      mode={NormalizationMode.SpineSoftTissues}\n                      currNormalizeMode={currNormalizeMode}\n                      onChange={this.handleNormalizeModeChange}\n                    />\n\n                    <NormalizationComponent\n                      mode={NormalizationMode.SpineBone}\n                      currNormalizeMode={currNormalizeMode}\n                      onChange={this.handleNormalizeModeChange}\n                    />\n                  </div>\n                  <div>\n                    <NormalizationComponent\n                      mode={NormalizationMode.Brain}\n                      currNormalizeMode={currNormalizeMode}\n                      onChange={this.handleNormalizeModeChange}\n                    />\n                    <NormalizationComponent\n                      mode={NormalizationMode.Lungs}\n                      currNormalizeMode={currNormalizeMode}\n                      onChange={this.handleNormalizeModeChange}\n                    />\n                    <Radio\n                      toggle\n                      value={\"seriesMode\"}\n                      checked={seriesMode === \"seriesMode\"}\n                      onChange={this.handleSeriesModeChange}\n                    />\n                    {\"  Enable Series mode\"}\n                  </div>\n                </div>\n                <div\n                  style={{\n                    display: \"flex\",\n                    justifyContent: \"center\",\n                  }}\n                >\n                  <div>\n                    {\" \"}\n                    {frameIndexes.length > 1 ? (\n                      <Dropdown\n                        placeholder=\"Switch Frame\"\n                        selection\n                        onChange={this.handleSwitchFrame}\n                        options={frameIndexes}\n                        value={currFrameIndex}\n                      />\n                    ) : null}{\" \"}\n                  </div>{\" \"}\n                </div>{\" \"}\n              </div>\n            </div>\n            {/* <div\n              style={{\n                display: \"flex\",\n                justifyContent: \"center\",\n              }}\n            >\n              {\" \"}\n              {currFilePath || null}{\" \"}\n            </div> */}\n            {totalFiles > 0 ? (\n              <div\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                }}\n              >\n                <div style={{ width: 600 }}>\n                  <div\n                    style={{\n                      display: \"flex\",\n                      justifyContent: \"center\",\n                    }}\n                  >\n                    {`${currFilePath}. ${currFileNo}/${totalFiles}`}\n                  </div>\n                  <div className=\"flex-container\">\n                    {isCommonAxialView ? <div>{\"S\"}</div> : null}\n                    <Slider\n                      value={currFileNo}\n                      step={1}\n                      min={1}\n                      max={totalFiles}\n                      onChange={this.switchImage}\n                    />\n                    {isCommonAxialView ? <div>{\"I\"}</div> : null}{\" \"}\n                  </div>\n                  {ifShowSagittalCoronal ? (\n                    <>\n                      <div className=\"flex-container\">\n                        {isCommonAxialView ? <div>{\"R\"}</div> : null}{\" \"}\n                        <Slider\n                          value={currentSagittalNo}\n                          step={1}\n                          min={1}\n                          max={totalSagittalFrames}\n                          onChange={this.switchSagittal}\n                        />\n                        {isCommonAxialView ? <div>{\"L\"}</div> : null}{\" \"}\n                      </div>\n                      <div className=\"flex-container\">\n                        {isCommonAxialView ? <div>{\"A\"}</div> : null}{\" \"}\n                        <Slider\n                          value={currentCoronaNo}\n                          step={1}\n                          min={1}\n                          max={totalCoronaFrames}\n                          onChange={this.switchCorona}\n                        />\n                        {isCommonAxialView ? <div>{\"P\"}</div> : null}{\" \"}\n                      </div>\n                    </>\n                  ) : null}\n                </div>\n              </div>\n            ) : null}\n            {hasDICOMExtension ? (\n              <div\n                // onMouseDown={this.onMouseDown0}\n                // onScroll={this.onMouseMove0}\n                style={{\n                  display: \"flex\",\n                  justifyContent: \"center\",\n                }}\n              >\n                <div\n                  style={{\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    justifyContent: \"center\",\n                    alignItems: \"center\",\n                  }}\n                >\n                  {isCommonAxialView ? <div>{\"A\"}</div> : null}{\" \"}\n                  <div\n                    style={{\n                      display: \"flex\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                    }}\n                  >\n                    {isCommonAxialView ? <div>{\"R\"}</div> : null}{\" \"}\n                    <canvas\n                      onMouseDown={this.onMouseCanvasDown}\n                      // onMouseUp={this.onMouseUp0}\n                      // onScroll={this.onMouseMove}\n                      ref={this.myCanvasRef}\n                      width={MAX_WIDTH_SERIES_MODE}\n                      height={MAX_HEIGHT_SERIES_MODE}\n                      style={{ backgroundColor: \"black\" }}\n                    />\n                    {isCommonAxialView ? <div>{\"L\"}</div> : null}{\" \"}\n                  </div>\n                  {isCommonAxialView ? <div>{\"P\"}</div> : null}{\" \"}\n                </div>\n\n                {ifShowSagittalCoronal ? (\n                  <>\n                    <div\n                      style={{\n                        display: \"flex\",\n                        flexDirection: \"column\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                      }}\n                    >\n                      {isCommonAxialView ? <div>{\"S\"}</div> : null}{\" \"}\n                      <div\n                        style={{\n                          display: \"flex\",\n                          justifyContent: \"center\",\n                          alignItems: \"center\",\n                        }}\n                      >\n                        {isCommonAxialView ? <div>{\"A\"}</div> : null}{\" \"}\n                        <canvas\n                          onMouseDown={this.onMouseCanvasDown}\n                          // onMouseUp={this.onMouseUp0}\n                          // onScroll={this.onMouseMove}\n                          ref={this.myCanvasRefSagittal}\n                          width={MAX_WIDTH_SERIES_MODE}\n                          height={MAX_HEIGHT_SERIES_MODE}\n                          style={{ backgroundColor: \"yellow\" }}\n                        />\n                        {isCommonAxialView ? <div>{\"P\"}</div> : null}{\" \"}\n                      </div>\n                      {isCommonAxialView ? <div>{\"I\"}</div> : null}{\" \"}\n                    </div>\n                    <div\n                      style={{\n                        display: \"flex\",\n                        flexDirection: \"column\",\n                        justifyContent: \"center\",\n                        alignItems: \"center\",\n                      }}\n                    >\n                      {isCommonAxialView ? <div>{\"S\"}</div> : null}{\" \"}\n                      <div\n                        style={{\n                          display: \"flex\",\n                          justifyContent: \"center\",\n                          alignItems: \"center\",\n                        }}\n                      >\n                        {isCommonAxialView ? <div>{\"R\"}</div> : null}{\" \"}\n                        <canvas\n                          onMouseDown={this.onMouseCanvasDown}\n                          // onMouseUp={this.onMouseUp0}\n                          // onScroll={this.onMouseMove}\n                          ref={this.myCanvasRefCorona}\n                          width={MAX_WIDTH_SERIES_MODE}\n                          height={MAX_HEIGHT_SERIES_MODE}\n                          style={{ backgroundColor: \"green\" }}\n                        />\n                        {isCommonAxialView ? <div>{\"L\"}</div> : null}{\" \"}\n                      </div>\n                      {isCommonAxialView ? <div>{\"I\"}</div> : null}{\" \"}\n                    </div>\n                  </>\n                ) : null}\n              </div>\n            ) : null}\n          </div>\n        </div>\n      </Hotkeys>\n    );\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}